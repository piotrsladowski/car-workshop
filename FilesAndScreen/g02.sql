-- phpMyAdmin SQL Dump
-- version 5.0.4
-- https://www.phpmyadmin.net/
--
-- Host: localhost
-- Generation Time: Feb 08, 2021 at 03:30 PM
-- Server version: 8.0.21
-- PHP Version: 7.4.14

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Database: `g02`
--

DELIMITER $$
--
-- Functions
--
CREATE DEFINER=`g02`@`localhost` FUNCTION `choose_part` (`cid` INT, `isog` TINYINT) RETURNS INT begin
	declare pid INT;
	declare done TINYINT default 0;
	declare c1 cursor for 
	(select p.id
		from cars_parts as cp 
		inner join parts as p on p.id=cp.part_id 
		where cp.car_id=(select model_id from cars where id=cid) 
		and p.damage_desc=(select damage from cars where id=cid) 
		and p.is_original=isog);
	declare continue handler for not found set done=1;

	open c1;
	select_loop: loop
		fetch c1 into pid;
		if done then 
			leave select_loop; 
		end if;
	end loop;
	close c1;
	return pid;
end$$

CREATE DEFINER=`g02`@`localhost` FUNCTION `fullname` (`name` VARCHAR(64), `surname` VARCHAR(64)) RETURNS VARCHAR(129) CHARSET utf8mb4 COLLATE utf8mb4_unicode_ci begin
return concat(name, ' ', surname);
end$$

CREATE DEFINER=`g02`@`localhost` FUNCTION `set_cost` (`pid` INT, `status` VARCHAR(64), `deadline` DATE) RETURNS DECIMAL(10,2) begin
	declare	v_cost DECIMAL(10, 2) default 0;
	declare done TINYINT default 0;
	declare v_price DECIMAL(10, 2);
	declare complex INT;
	declare robo DECIMAL(10, 2);
	declare c1 cursor for 
	(select p.price, p.complexity
		from cars_parts as cp 
		inner join parts as p on p.id=cp.part_id 
		where cp.car_id=(select model_id from cars where id=cid) 
		and p.damage_desc=(select damage from cars where id=cid) 
		and p.is_original=isog); 
	declare continue handler for not found set done=1;

	if  status = 'rejected' then
		set v_cost = 0;
	else
		set robo = 0.0;

		if isog = 1 then 
			set robo = robo + 0.1;
		end if;

		if ( DATEDIFF(deadline, CURDATE()) > 0 and DATEDIFF(deadline, CURDATE()) <= 2 ) then
			set robo = robo + 0.1;
		end if;

		open c1;
		select_loop: loop
			fetch c1 into v_price, complex;
			if done then 
				leave select_loop; 
			end if;
		end loop;
		close c1;
		case complex
			when 1 then 
				set robo = robo + 0.2;
			when 2 then
				set robo = robo + 0.3;
			when 3 then
				set robo = robo + 0.4;
		end case;
		set v_cost = v_price + v_price*robo;
	end if;
	return v_cost;
end$$

DELIMITER ;

-- --------------------------------------------------------

--
-- Table structure for table `cars`
--

CREATE TABLE `cars` (
  `id` int UNSIGNED NOT NULL,
  `description` varchar(200) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `model_id` int UNSIGNED NOT NULL,
  `vin_number` varchar(64) COLLATE utf8mb4_unicode_ci NOT NULL,
  `damage` int UNSIGNED NOT NULL,
  `is_stolen` tinyint DEFAULT NULL,
  `car_counter` int DEFAULT NULL,
  `color` varchar(6) COLLATE utf8mb4_unicode_ci NOT NULL,
  `is_considered` tinyint NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `cars`
--

INSERT INTO `cars` (`id`, `description`, `model_id`, `vin_number`, `damage`, `is_stolen`, `car_counter`, `color`, `is_considered`) VALUES
(1, 'asdagfq', 122, 'asdqwr1324', 9, 0, 6, '583c3c', 0),
(2, 'trerwer', 122, 'ewvsdv', 19, 0, 234, '864141', 0);

-- --------------------------------------------------------

--
-- Table structure for table `cars_parts`
--

CREATE TABLE `cars_parts` (
  `car_id` int UNSIGNED NOT NULL,
  `part_id` int UNSIGNED NOT NULL
) ;

--
-- Dumping data for table `cars_parts`
--

INSERT INTO `cars_parts` (`car_id`, `part_id`) VALUES
(1, 1),
(2, 1),
(3, 1),
(4, 1),
(5, 1),
(24, 1),
(25, 1),
(103, 1),
(104, 1),
(105, 1),
(106, 1),
(107, 1),
(108, 1),
(109, 1),
(110, 1),
(111, 1),
(112, 1),
(113, 1),
(114, 1),
(115, 1),
(116, 1),
(117, 1),
(118, 1),
(119, 1),
(120, 1),
(121, 1),
(122, 1),
(123, 1),
(124, 1),
(125, 1),
(126, 1),
(127, 1),
(128, 1),
(129, 1),
(130, 1),
(131, 1),
(132, 1),
(133, 1),
(134, 1),
(135, 1),
(136, 1),
(137, 1),
(138, 1),
(139, 1),
(1, 2),
(2, 2),
(3, 2),
(4, 2),
(5, 2),
(24, 2),
(25, 2),
(103, 2),
(104, 2),
(105, 2),
(106, 2),
(107, 2),
(108, 2),
(109, 2),
(110, 2),
(111, 2),
(112, 2),
(113, 2),
(114, 2),
(115, 2),
(116, 2),
(117, 2),
(118, 2),
(119, 2),
(120, 2),
(121, 2),
(122, 2),
(123, 2),
(124, 2),
(125, 2),
(126, 2),
(127, 2),
(128, 2),
(129, 2),
(130, 2),
(131, 2),
(132, 2),
(133, 2),
(134, 2),
(135, 2),
(136, 2),
(137, 2),
(138, 2),
(139, 2),
(1, 3),
(2, 3),
(3, 3),
(4, 3),
(5, 3),
(24, 3),
(25, 3),
(103, 3),
(104, 3),
(105, 3),
(106, 3),
(107, 3),
(108, 3),
(109, 3),
(110, 3),
(111, 3),
(112, 3),
(113, 3),
(114, 3),
(115, 3),
(116, 3),
(117, 3),
(118, 3),
(119, 3),
(120, 3),
(121, 3),
(122, 3),
(123, 3),
(124, 3),
(125, 3),
(126, 3),
(127, 3),
(128, 3),
(129, 3),
(130, 3),
(131, 3),
(132, 3),
(133, 3),
(134, 3),
(135, 3),
(136, 3),
(137, 3),
(138, 3),
(139, 3),
(1, 4),
(2, 4),
(3, 4),
(4, 4),
(5, 4),
(24, 4),
(25, 4),
(103, 4),
(104, 4),
(105, 4),
(106, 4),
(107, 4),
(108, 4),
(109, 4),
(110, 4),
(111, 4),
(112, 4),
(113, 4),
(114, 4),
(115, 4),
(116, 4),
(117, 4),
(118, 4),
(119, 4),
(120, 4),
(121, 4),
(122, 4),
(123, 4),
(124, 4),
(125, 4),
(126, 4),
(127, 4),
(128, 4),
(129, 4),
(130, 4),
(131, 4),
(132, 4),
(133, 4),
(134, 4),
(135, 4),
(136, 4),
(137, 4),
(138, 4),
(139, 4),
(1, 5),
(2, 5),
(3, 5),
(4, 5),
(5, 5),
(24, 5),
(25, 5),
(103, 5),
(104, 5),
(105, 5),
(106, 5),
(107, 5),
(108, 5),
(109, 5),
(110, 5),
(111, 5),
(112, 5),
(113, 5),
(114, 5),
(115, 5),
(116, 5),
(117, 5),
(118, 5),
(119, 5),
(120, 5),
(121, 5),
(122, 5),
(123, 5),
(124, 5),
(125, 5),
(126, 5),
(127, 5),
(128, 5),
(129, 5),
(130, 5),
(131, 5),
(132, 5),
(133, 5),
(134, 5),
(135, 5),
(136, 5),
(137, 5),
(138, 5),
(139, 5),
(1, 6),
(2, 6),
(3, 6),
(4, 6),
(5, 6),
(24, 6),
(25, 6),
(103, 6),
(104, 6),
(105, 6),
(106, 6),
(107, 6),
(108, 6),
(109, 6),
(110, 6),
(111, 6),
(112, 6),
(113, 6),
(114, 6),
(115, 6),
(116, 6),
(117, 6),
(118, 6),
(119, 6),
(120, 6),
(121, 6),
(122, 6),
(123, 6),
(124, 6),
(125, 6),
(126, 6),
(127, 6),
(128, 6),
(129, 6),
(130, 6),
(131, 6),
(132, 6),
(133, 6),
(134, 6),
(135, 6),
(136, 6),
(137, 6),
(138, 6),
(139, 6),
(1, 7),
(2, 7),
(3, 7),
(4, 7),
(5, 7),
(24, 7),
(25, 7),
(103, 7),
(104, 7),
(105, 7),
(106, 7),
(107, 7),
(108, 7),
(109, 7),
(110, 7),
(111, 7),
(112, 7),
(113, 7),
(114, 7),
(115, 7),
(116, 7),
(117, 7),
(118, 7),
(119, 7),
(120, 7),
(121, 7),
(122, 7),
(123, 7),
(124, 7),
(125, 7),
(126, 7),
(127, 7),
(128, 7),
(129, 7),
(130, 7),
(131, 7),
(132, 7),
(133, 7),
(134, 7),
(135, 7),
(136, 7),
(137, 7),
(138, 7),
(139, 7),
(1, 8),
(2, 8),
(3, 8),
(4, 8),
(5, 8),
(24, 8),
(25, 8),
(103, 8),
(104, 8),
(105, 8),
(106, 8),
(107, 8),
(108, 8),
(109, 8),
(110, 8),
(111, 8),
(112, 8),
(113, 8),
(114, 8),
(115, 8),
(116, 8),
(117, 8),
(118, 8),
(119, 8),
(120, 8),
(121, 8),
(122, 8),
(123, 8),
(124, 8),
(125, 8),
(126, 8),
(127, 8),
(128, 8),
(129, 8),
(130, 8),
(131, 8),
(132, 8),
(133, 8),
(134, 8),
(135, 8),
(136, 8),
(137, 8),
(138, 8),
(139, 8),
(1, 9),
(2, 9),
(3, 9),
(4, 9),
(5, 9),
(24, 9),
(25, 9),
(103, 9),
(104, 9),
(105, 9),
(106, 9),
(107, 9),
(108, 9),
(109, 9),
(110, 9),
(111, 9),
(112, 9),
(113, 9),
(114, 9),
(115, 9),
(116, 9),
(117, 9),
(118, 9),
(119, 9),
(120, 9),
(121, 9),
(122, 9),
(123, 9),
(124, 9),
(125, 9),
(126, 9),
(127, 9),
(128, 9),
(129, 9),
(130, 9),
(131, 9),
(132, 9),
(133, 9),
(134, 9),
(135, 9),
(136, 9),
(137, 9),
(138, 9),
(139, 9),
(1, 10),
(2, 10),
(3, 10),
(4, 10),
(5, 10),
(24, 10),
(25, 10),
(103, 10),
(104, 10),
(105, 10),
(106, 10),
(107, 10),
(108, 10),
(109, 10),
(110, 10),
(111, 10),
(112, 10),
(113, 10),
(114, 10),
(115, 10),
(116, 10),
(117, 10),
(118, 10),
(119, 10),
(120, 10),
(121, 10),
(122, 10),
(123, 10),
(124, 10),
(125, 10),
(126, 10),
(127, 10),
(128, 10),
(129, 10),
(130, 10),
(131, 10),
(132, 10),
(133, 10),
(134, 10),
(135, 10),
(136, 10),
(137, 10),
(138, 10),
(139, 10),
(1, 11),
(2, 11),
(3, 11),
(4, 11),
(5, 11),
(24, 11),
(25, 11),
(103, 11),
(104, 11),
(105, 11),
(106, 11),
(107, 11),
(108, 11),
(109, 11),
(110, 11),
(111, 11),
(112, 11),
(113, 11),
(114, 11),
(115, 11),
(116, 11),
(117, 11),
(118, 11),
(119, 11),
(120, 11),
(121, 11),
(122, 11),
(123, 11),
(124, 11),
(125, 11),
(126, 11),
(127, 11),
(128, 11),
(129, 11),
(130, 11),
(131, 11),
(132, 11),
(133, 11),
(134, 11),
(135, 11),
(136, 11),
(137, 11),
(138, 11),
(139, 11),
(1, 12),
(2, 12),
(3, 12),
(4, 12),
(5, 12),
(24, 12),
(25, 12),
(103, 12),
(104, 12),
(105, 12),
(106, 12),
(107, 12),
(108, 12),
(109, 12),
(110, 12),
(111, 12),
(112, 12),
(113, 12),
(114, 12),
(115, 12),
(116, 12),
(117, 12),
(118, 12),
(119, 12),
(120, 12),
(121, 12),
(122, 12),
(123, 12),
(124, 12),
(125, 12),
(126, 12),
(127, 12),
(128, 12),
(129, 12),
(130, 12),
(131, 12),
(132, 12),
(133, 12),
(134, 12),
(135, 12),
(136, 12),
(137, 12),
(138, 12),
(139, 12),
(1, 13),
(2, 13),
(3, 13),
(4, 13),
(5, 13),
(24, 13),
(25, 13),
(103, 13),
(104, 13),
(105, 13),
(106, 13),
(107, 13),
(108, 13),
(109, 13),
(110, 13),
(111, 13),
(112, 13),
(113, 13),
(114, 13),
(115, 13),
(116, 13),
(117, 13),
(118, 13),
(119, 13),
(120, 13),
(121, 13),
(122, 13),
(123, 13),
(124, 13),
(125, 13),
(126, 13),
(127, 13),
(128, 13),
(129, 13),
(130, 13),
(131, 13),
(132, 13),
(133, 13),
(134, 13),
(135, 13),
(136, 13),
(137, 13),
(138, 13),
(139, 13),
(1, 14),
(2, 14),
(3, 14),
(4, 14),
(5, 14),
(24, 14),
(25, 14),
(103, 14),
(104, 14),
(105, 14),
(106, 14),
(107, 14),
(108, 14),
(109, 14),
(110, 14),
(111, 14),
(112, 14),
(113, 14),
(114, 14),
(115, 14),
(116, 14),
(117, 14),
(118, 14),
(119, 14),
(120, 14),
(121, 14),
(122, 14),
(123, 14),
(124, 14),
(125, 14),
(126, 14),
(127, 14),
(128, 14),
(129, 14),
(130, 14),
(131, 14),
(132, 14),
(133, 14),
(134, 14),
(135, 14),
(136, 14),
(137, 14),
(138, 14),
(139, 14),
(1, 15),
(2, 15),
(3, 15),
(4, 15),
(5, 15),
(24, 15),
(25, 15),
(103, 15),
(104, 15),
(105, 15),
(106, 15),
(107, 15),
(108, 15),
(109, 15),
(110, 15),
(111, 15),
(112, 15),
(113, 15),
(114, 15),
(115, 15),
(116, 15),
(117, 15),
(118, 15),
(119, 15),
(120, 15),
(121, 15),
(122, 15),
(123, 15),
(124, 15),
(125, 15),
(126, 15),
(127, 15),
(128, 15),
(129, 15),
(130, 15),
(131, 15),
(132, 15),
(133, 15),
(134, 15),
(135, 15),
(136, 15),
(137, 15),
(138, 15),
(139, 15),
(1, 16),
(2, 16),
(3, 16),
(4, 16),
(5, 16),
(24, 16),
(25, 16),
(103, 16),
(104, 16),
(105, 16),
(106, 16),
(107, 16),
(108, 16),
(109, 16),
(110, 16),
(111, 16),
(112, 16),
(113, 16),
(114, 16),
(115, 16),
(116, 16),
(117, 16),
(118, 16),
(119, 16),
(120, 16),
(121, 16),
(122, 16),
(123, 16),
(124, 16),
(125, 16),
(126, 16),
(127, 16),
(128, 16),
(129, 16),
(130, 16),
(131, 16),
(132, 16),
(133, 16),
(134, 16),
(135, 16),
(136, 16),
(137, 16),
(138, 16),
(139, 16),
(1, 17),
(2, 17),
(3, 17),
(4, 17),
(5, 17),
(24, 17),
(25, 17),
(103, 17),
(104, 17),
(105, 17),
(106, 17),
(107, 17),
(108, 17),
(109, 17),
(110, 17),
(111, 17),
(112, 17),
(113, 17),
(114, 17),
(115, 17),
(116, 17),
(117, 17),
(118, 17),
(119, 17),
(120, 17),
(121, 17),
(122, 17),
(123, 17),
(124, 17),
(125, 17),
(126, 17),
(127, 17),
(128, 17),
(129, 17),
(130, 17),
(131, 17),
(132, 17),
(133, 17),
(134, 17),
(135, 17),
(136, 17),
(137, 17),
(138, 17),
(139, 17),
(1, 18),
(2, 18),
(3, 18),
(4, 18),
(5, 18),
(24, 18),
(25, 18),
(103, 18),
(104, 18),
(105, 18),
(106, 18),
(107, 18),
(108, 18),
(109, 18),
(110, 18),
(111, 18),
(112, 18),
(113, 18),
(114, 18),
(115, 18),
(116, 18),
(117, 18),
(118, 18),
(119, 18),
(120, 18),
(121, 18),
(122, 18),
(123, 18),
(124, 18),
(125, 18),
(126, 18),
(127, 18),
(128, 18),
(129, 18),
(130, 18),
(131, 18),
(132, 18),
(133, 18),
(134, 18),
(135, 18),
(136, 18),
(137, 18),
(138, 18),
(139, 18),
(1, 19),
(2, 19),
(3, 19),
(4, 19),
(5, 19),
(24, 19),
(25, 19),
(103, 19),
(104, 19),
(105, 19),
(106, 19),
(107, 19),
(108, 19),
(109, 19),
(110, 19),
(111, 19),
(112, 19),
(113, 19),
(114, 19),
(115, 19),
(116, 19),
(117, 19),
(118, 19),
(119, 19),
(120, 19),
(121, 19),
(122, 19),
(123, 19),
(124, 19),
(125, 19),
(126, 19),
(127, 19),
(128, 19),
(129, 19),
(130, 19),
(131, 19),
(132, 19),
(133, 19),
(134, 19),
(135, 19),
(136, 19),
(137, 19),
(138, 19),
(139, 19),
(1, 20),
(2, 20),
(3, 20),
(4, 20),
(5, 20),
(24, 20),
(25, 20),
(103, 20),
(104, 20),
(105, 20),
(106, 20),
(107, 20),
(108, 20),
(109, 20),
(110, 20),
(111, 20),
(112, 20),
(113, 20),
(114, 20),
(115, 20),
(116, 20),
(117, 20),
(118, 20),
(119, 20),
(120, 20),
(121, 20),
(122, 20),
(123, 20),
(124, 20),
(125, 20),
(126, 20),
(127, 20),
(128, 20),
(129, 20),
(130, 20),
(131, 20),
(132, 20),
(133, 20),
(134, 20),
(135, 20),
(136, 20),
(137, 20),
(138, 20),
(139, 20),
(1, 21),
(2, 21),
(3, 21),
(4, 21),
(5, 21),
(24, 21),
(25, 21),
(103, 21),
(104, 21),
(105, 21),
(106, 21),
(107, 21),
(108, 21),
(109, 21),
(110, 21),
(111, 21),
(112, 21),
(113, 21),
(114, 21),
(115, 21),
(116, 21),
(117, 21),
(118, 21),
(119, 21),
(120, 21),
(121, 21),
(122, 21),
(123, 21),
(124, 21),
(125, 21),
(126, 21),
(127, 21),
(128, 21),
(129, 21),
(130, 21),
(131, 21),
(132, 21),
(133, 21),
(134, 21),
(135, 21),
(136, 21),
(137, 21),
(138, 21),
(139, 21),
(1, 22),
(2, 22),
(3, 22),
(4, 22),
(5, 22),
(24, 22),
(25, 22),
(103, 22),
(104, 22),
(105, 22),
(106, 22),
(107, 22),
(108, 22),
(109, 22),
(110, 22),
(111, 22),
(112, 22),
(113, 22),
(114, 22),
(115, 22),
(116, 22),
(117, 22),
(118, 22),
(119, 22),
(120, 22),
(121, 22),
(122, 22),
(123, 22),
(124, 22),
(125, 22),
(126, 22),
(127, 22),
(128, 22),
(129, 22),
(130, 22),
(131, 22),
(132, 22),
(133, 22),
(134, 22),
(135, 22),
(136, 22),
(137, 22),
(138, 22),
(139, 22),
(1, 23),
(2, 23),
(3, 23),
(4, 23),
(5, 23),
(24, 23),
(25, 23),
(103, 23),
(104, 23),
(105, 23),
(106, 23),
(107, 23),
(108, 23),
(109, 23),
(110, 23),
(111, 23),
(112, 23),
(113, 23),
(114, 23),
(115, 23),
(116, 23),
(117, 23),
(118, 23),
(119, 23),
(120, 23),
(121, 23),
(122, 23),
(123, 23),
(124, 23),
(125, 23),
(126, 23),
(127, 23),
(128, 23),
(129, 23),
(130, 23),
(131, 23),
(132, 23),
(133, 23),
(134, 23),
(135, 23),
(136, 23),
(137, 23),
(138, 23),
(139, 23),
(1, 24),
(2, 24),
(3, 24),
(4, 24),
(5, 24),
(24, 24),
(25, 24),
(103, 24),
(104, 24),
(105, 24),
(106, 24),
(107, 24),
(108, 24),
(109, 24),
(110, 24),
(111, 24),
(112, 24),
(113, 24),
(114, 24),
(115, 24),
(116, 24),
(117, 24),
(118, 24),
(119, 24),
(120, 24),
(121, 24),
(122, 24),
(123, 24),
(124, 24),
(125, 24),
(126, 24),
(127, 24),
(128, 24),
(129, 24),
(130, 24),
(131, 24),
(132, 24),
(133, 24),
(134, 24),
(135, 24),
(136, 24),
(137, 24),
(138, 24),
(139, 24),
(1, 25),
(2, 25),
(3, 25),
(4, 25),
(5, 25),
(24, 25),
(25, 25),
(103, 25),
(104, 25),
(105, 25),
(106, 25),
(107, 25),
(108, 25),
(109, 25),
(110, 25),
(111, 25),
(112, 25),
(113, 25),
(114, 25),
(115, 25),
(116, 25),
(117, 25),
(118, 25),
(119, 25),
(120, 25),
(121, 25),
(122, 25),
(123, 25),
(124, 25),
(125, 25),
(126, 25),
(127, 25),
(128, 25),
(129, 25),
(130, 25),
(131, 25),
(132, 25),
(133, 25),
(134, 25),
(135, 25),
(136, 25),
(137, 25),
(138, 25),
(139, 25),
(1, 26),
(2, 26),
(3, 26),
(4, 26),
(5, 26),
(24, 26),
(25, 26),
(103, 26),
(104, 26),
(105, 26),
(106, 26),
(107, 26),
(108, 26),
(109, 26),
(110, 26),
(111, 26),
(112, 26),
(113, 26),
(114, 26),
(115, 26),
(116, 26),
(117, 26),
(118, 26),
(119, 26),
(120, 26),
(121, 26),
(122, 26),
(123, 26),
(124, 26),
(125, 26),
(126, 26),
(127, 26),
(128, 26),
(129, 26),
(130, 26),
(131, 26),
(132, 26),
(133, 26),
(134, 26),
(135, 26),
(136, 26),
(137, 26),
(138, 26),
(139, 26),
(1, 27),
(2, 27),
(3, 27),
(4, 27),
(5, 27),
(24, 27),
(25, 27),
(103, 27),
(104, 27),
(105, 27),
(106, 27),
(107, 27),
(108, 27),
(109, 27),
(110, 27),
(111, 27),
(112, 27),
(113, 27),
(114, 27),
(115, 27),
(116, 27),
(117, 27),
(118, 27),
(119, 27),
(120, 27),
(121, 27),
(122, 27),
(123, 27),
(124, 27),
(125, 27),
(126, 27),
(127, 27),
(128, 27),
(129, 27),
(130, 27),
(131, 27),
(132, 27),
(133, 27),
(134, 27),
(135, 27),
(136, 27),
(137, 27),
(138, 27),
(139, 27),
(1, 28),
(2, 28),
(3, 28),
(4, 28),
(5, 28),
(24, 28),
(25, 28),
(103, 28),
(104, 28),
(105, 28),
(106, 28),
(107, 28),
(108, 28),
(109, 28),
(110, 28),
(111, 28),
(112, 28),
(113, 28),
(114, 28),
(115, 28),
(116, 28),
(117, 28),
(118, 28),
(119, 28),
(120, 28),
(121, 28),
(122, 28),
(123, 28),
(124, 28),
(125, 28),
(126, 28),
(127, 28),
(128, 28),
(129, 28),
(130, 28),
(131, 28),
(132, 28),
(133, 28),
(134, 28),
(135, 28),
(136, 28),
(137, 28),
(138, 28),
(139, 28),
(1, 29),
(2, 29),
(3, 29),
(4, 29),
(5, 29),
(24, 29),
(25, 29),
(103, 29),
(104, 29),
(105, 29),
(106, 29),
(107, 29),
(108, 29),
(109, 29),
(110, 29),
(111, 29),
(112, 29),
(113, 29),
(114, 29),
(115, 29),
(116, 29),
(117, 29),
(118, 29),
(119, 29),
(120, 29),
(121, 29),
(122, 29),
(123, 29),
(124, 29),
(125, 29),
(126, 29),
(127, 29),
(128, 29),
(129, 29),
(130, 29),
(131, 29),
(132, 29),
(133, 29),
(134, 29),
(135, 29),
(136, 29),
(137, 29),
(138, 29),
(139, 29);

-- --------------------------------------------------------

--
-- Table structure for table `car_models`
--

CREATE TABLE `car_models` (
  `id` int UNSIGNED NOT NULL,
  `car_model` varchar(64) COLLATE utf8mb4_unicode_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `car_models`
--

INSERT INTO `car_models` (`id`, `car_model`) VALUES
(25, '	Dacia Duster'),
(138, 'BMW Serii 3'),
(127, 'Citroen C3'),
(132, 'Dacia Dokker'),
(131, 'Dacia Lodgy'),
(112, 'Dacia Sandero'),
(2, 'Fiat 126p'),
(1, 'Fiat Punto'),
(107, 'Fiat Tipo'),
(135, 'Ford Fiesta'),
(130, 'Hyundai i20'),
(121, 'Hyundai i30'),
(111, 'Hyundai Tucson'),
(115, 'Kia Ceed'),
(118, 'Kia Sportage'),
(129, 'Mazda CX-3'),
(139, 'Mazda CX-5'),
(117, 'Nissan Qashqai'),
(104, 'Opel Astra'),
(113, 'Opel Corsa'),
(133, 'Opel Insignia'),
(136, 'Renault Captur'),
(3, 'Renault Clio'),
(119, 'Renault Megane'),
(123, 'Seat Leon'),
(24, 'Skoda Fabia'),
(122, 'Skoda Karoq'),
(126, 'Skoda Kodiaq'),
(4, 'Skoda Octavia'),
(108, 'Skoda Rapid'),
(114, 'Skoda Superb'),
(137, 'Suzuki Vitara'),
(106, 'Toyota Auris'),
(128, 'Toyota Aygo'),
(110, 'Toyota C-HR'),
(5, 'Toyota Corolla'),
(120, 'Toyota RAV4'),
(103, 'Toyota Yaris'),
(105, 'Volkswagen Golf'),
(116, 'Volkswagen Passat'),
(125, 'Volkswagen Polo'),
(134, 'Volkswagen T-Roc'),
(109, 'Volkswagen Tiguan'),
(124, 'Volvo XC60');

-- --------------------------------------------------------

--
-- Table structure for table `damages`
--

CREATE TABLE `damages` (
  `id` int UNSIGNED NOT NULL,
  `damage_type` varchar(64) COLLATE utf8mb4_unicode_ci NOT NULL,
  `description` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `damages`
--

INSERT INTO `damages` (`id`, `damage_type`, `description`) VALUES
(2, 'Car Diagnostics', 'Battery replacement'),
(3, 'Car Diagnostics', 'Exhaust gas analysis'),
(4, 'Car Diagnostics', 'Shocks absorber test'),
(5, 'Car Diagnostics', 'Battery test'),
(6, 'Car Diagnostics', 'Wheel alignment'),
(7, 'Car Diagnostics', 'Alignment of lamps'),
(8, 'Car Diagnostics', 'Computer diagnostics'),
(9, 'Repair of the brake system', 'Replacement of brake pads'),
(10, 'Repair of the brake system', 'Replacement of brake discs'),
(11, 'Repair of the brake system', 'Replacing the master cylinder'),
(12, 'Repair of the brake system', 'Hand brake adjustment'),
(13, 'Repair of the brake system', 'Changing the brake fluid'),
(14, 'Vulcanization', 'Tyre change aluminium rim'),
(15, 'Vulcanization', 'Tyre change steel rim'),
(16, 'Vulcanization', 'Tyre repair'),
(17, 'Repair of the ignition system', 'Engine valve adjustment'),
(18, 'Repair of the ignition system', 'Replacing the ignition coil'),
(19, 'Repair of the ignition system', 'Changing spark plugs'),
(20, 'Repair of the ignition system', 'Replacing the ignition cables'),
(21, 'Repairs to the powertrain and engine accessories', 'Replacing the clutch'),
(22, 'Repairs to the powertrain and engine accessories', 'Replacing the timing gear'),
(23, 'Repairs to the powertrain and engine accessories', 'Water pump replacement'),
(24, 'Repairs to the powertrain and engine accessories', 'Head gasket replacement'),
(25, 'Repairs to the powertrain and engine accessories', 'Dismantling the engine - verification - repair');

-- --------------------------------------------------------

--
-- Table structure for table `parts`
--

CREATE TABLE `parts` (
  `id` int UNSIGNED NOT NULL,
  `code` varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `description` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `amount` int NOT NULL,
  `price` decimal(10,2) NOT NULL,
  `is_original` tinyint DEFAULT NULL,
  `damage_desc` int UNSIGNED NOT NULL,
  `complexity` int DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `parts`
--

INSERT INTO `parts` (`id`, `code`, `description`, `amount`, `price`, `is_original`, `damage_desc`, `complexity`) VALUES
(1, 'B-O', 'Battery', 5, '300.00', 1, 2, 1),
(2, 'B-Z', 'Battery', 6, '150.00', 0, 2, 1),
(3, 'BP-O', 'Brake Pads', 3, '100.00', 1, 9, 1),
(4, 'BP-Z', 'Brake Pads', 2, '80.00', 0, 9, 1),
(5, 'D-O', 'Discs', 2, '150.00', 1, 10, 1),
(6, 'D-Z', 'Discs', 2, '100.00', 0, 10, 1),
(7, 'BMC-O', 'Brake Master Cylinder', 1, '500.00', 1, 11, 2),
(8, 'BMC-Z', 'Brake Master Cylinder', 1, '400.00', 0, 11, 2),
(9, 'BL-O', 'Brake Liquid', 10, '120.00', 1, 13, 1),
(10, 'BL-Z', 'Brake Liquid', 10, '100.00', 0, 13, 1),
(11, 'TRK-O', 'Tyre Repair Kit', 15, '100.00', 1, 14, 1),
(12, 'TRK-O', 'Tyre Repair Kit', 15, '100.00', 1, 15, 1),
(13, 'TRK-O', 'Tyre Repair Kit', 15, '100.00', 1, 16, 1),
(14, 'IC-O', 'Ignition Coil', 2, '250.00', 1, 18, 3),
(15, 'IC-Z', 'Ignition Coil', 2, '200.00', 0, 18, 3),
(16, 'P-O', 'Plugs', 10, '150.00', 1, 19, 2),
(17, 'P-Z', 'Plugs', 10, '150.00', 0, 19, 2),
(18, 'IC-O', 'Ignition Cables', 0, '150.00', 1, 20, 3),
(19, 'IC-Z', 'Ignition Cables', 1, '150.00', 0, 20, 3),
(20, 'Clu-O', 'Clutch', 2, '500.00', 1, 21, 3),
(21, 'Clu-Z', 'Clutch', 2, '400.00', 0, 21, 3),
(22, 'Cam-O', 'Camshaft', 1, '750.00', 1, 22, 3),
(23, 'Cam-Z', 'Camshaft', 0, '650.00', 0, 22, 3),
(24, 'WP-O', 'Water Pump', 0, '500.00', 1, 23, 3),
(25, 'WP-Z', 'Water Pump', 1, '400.00', 0, 23, 3),
(26, 'GUH-O', 'Gasket Under Head', 2, '760.00', 1, 24, 3),
(27, 'GUH-Z', 'Gasket Under Head', 1, '660.00', 0, 24, 3),
(28, 'Eng-O', 'Engine', 1, '1500.00', 1, 25, 3),
(29, 'Eng-Z', 'Engine', 1, '1400.00', 0, 25, 3);

-- --------------------------------------------------------

--
-- Table structure for table `realisations`
--

CREATE TABLE `realisations` (
  `id` int UNSIGNED NOT NULL,
  `car_id` int UNSIGNED NOT NULL,
  `part_id` int UNSIGNED NOT NULL,
  `status` varchar(64) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `worker_id` int UNSIGNED NOT NULL,
  `repair_cost` decimal(10,2) NOT NULL,
  `deadline` datetime DEFAULT NULL,
  `description` varchar(200) COLLATE utf8mb4_unicode_ci DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Triggers `realisations`
--
DELIMITER $$
CREATE TRIGGER `after_new_realisation` AFTER INSERT ON `realisations` FOR EACH ROW begin
	if NEW.status <> 'rejected' then
		update cars set is_considered=1 where id=NEW.car_id;
		update workers set busy=1 where id=NEW.worker_id;
	end if;
end
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `before_new_realisation` BEFORE INSERT ON `realisations` FOR EACH ROW begin
	if (NEW.repair_cost = 0 and NEW.status <> 'rejected') then
		set NEW.status = 'rejected';
	end if;
end
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `release_worker` AFTER UPDATE ON `realisations` FOR EACH ROW begin
	if NEW.status = 'finished' then
		update workers set busy=0 where id=NEW.worker_id;
	end if;
end
$$
DELIMITER ;

-- --------------------------------------------------------

--
-- Table structure for table `workers`
--

CREATE TABLE `workers` (
  `id` int UNSIGNED NOT NULL,
  `name` varchar(20) COLLATE utf8mb4_unicode_ci NOT NULL,
  `surname` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
  `salary` decimal(10,2) DEFAULT NULL,
  `works_til` datetime NOT NULL,
  `has_driving_license` tinyint(1) DEFAULT NULL,
  `is_working` tinyint(1) DEFAULT NULL,
  `busy` tinyint(1) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `workers`
--

INSERT INTO `workers` (`id`, `name`, `surname`, `salary`, `works_til`, `has_driving_license`, `is_working`, `busy`) VALUES
(1, 'Antoni', 'Nowak', '4300.00', '2021-10-28 18:00:00', 1, 1, 0),
(2, 'Jan', 'Nowak', '4000.00', '2021-10-28 18:00:00', 0, 1, 0),
(3, 'Jakub', 'Kowalski', '4100.00', '2022-10-28 18:00:00', 1, 1, 0),
(4, 'Aleksander', 'Wójcik', '5300.00', '2022-09-28 18:00:00', 1, 1, 0),
(5, 'Mikołaj', 'Kowalczyk', '2000.00', '2021-02-28 18:00:00', 0, 1, 0);

--
-- Indexes for dumped tables
--

--
-- Indexes for table `cars`
--
ALTER TABLE `cars`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `id_UNIQUE` (`id`);

--
-- Indexes for table `cars_parts`
--
ALTER TABLE `cars_parts`
  ADD PRIMARY KEY (`car_id`,`part_id`),
  ADD KEY `idx1` (`car_id`);

--
-- Indexes for table `car_models`
--
ALTER TABLE `car_models`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `car_model_UNIQUE` (`car_model`),
  ADD UNIQUE KEY `id_UNIQUE` (`id`);

--
-- Indexes for table `damages`
--
ALTER TABLE `damages`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `id_UNIQUE` (`id`);

--
-- Indexes for table `parts`
--
ALTER TABLE `parts`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `id_UNIQUE` (`id`),
  ADD KEY `fk_parts_damages_idx` (`damage_desc`);

--
-- Indexes for table `realisations`
--
ALTER TABLE `realisations`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `id_UNIQUE` (`id`);

--
-- Indexes for table `workers`
--
ALTER TABLE `workers`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `id_UNIQUE` (`id`);

--
-- AUTO_INCREMENT for dumped tables
--

--
-- AUTO_INCREMENT for table `cars`
--
ALTER TABLE `cars`
  MODIFY `id` int UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=3;

--
-- AUTO_INCREMENT for table `car_models`
--
ALTER TABLE `car_models`
  MODIFY `id` int UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=140;

--
-- AUTO_INCREMENT for table `damages`
--
ALTER TABLE `damages`
  MODIFY `id` int UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=26;

--
-- AUTO_INCREMENT for table `parts`
--
ALTER TABLE `parts`
  MODIFY `id` int UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=30;

--
-- AUTO_INCREMENT for table `realisations`
--
ALTER TABLE `realisations`
  MODIFY `id` int UNSIGNED NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `workers`
--
ALTER TABLE `workers`
  MODIFY `id` int UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=6;

--
-- Constraints for dumped tables
--

--
-- Constraints for table `parts`
--
ALTER TABLE `parts`
  ADD CONSTRAINT `fk_parts_damages` FOREIGN KEY (`damage_desc`) REFERENCES `damages` (`id`);
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
